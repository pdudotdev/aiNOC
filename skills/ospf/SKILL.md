---
name: OSPF Troubleshooting
description: "OSPF adjacency, LSDB, area types, authentication, route filtering, and redistribution — symptom-first decision trees with lookup tables"
---

# OSPF Troubleshooting Skill

## Scope
OSPF adjacency, LSDB, area types, authentication, route filtering, redistribution receipt.
Covers R1A, R2C, R3C, R6A, R7A, R8C, R10C, R11C (NY HQ) and R18M, R19M, R20M (London Branch).

## Start Here: Neighbor State

When an OSPF neighbor is not FULL or missing entirely:

```
get_ospf(device, "neighbors")
```

| State | Root Cause |
|-------|-----------|
| FULL | Healthy |
| EXSTART / EXCHANGE | MTU mismatch — check `ip ospf mtu-ignore` or fix MTU |
| INIT | Hello one-way: ACL blocking 224.0.0.5/224.0.0.6, wrong auth |
| 2WAY | DR/BDR election only (non-DR/BDR on broadcast) — normal for non-DR routers |
| DOWN | No hellos received: interface down, passive interface, or wrong area |

### Query Reference
| Query | What it returns | Use when |
|-------|----------------|----------|
| `neighbors` | Neighbor state, router-id, interface | Checking adjacency health |
| `interfaces` | Timer values, auth type, passive flag, area, network type, cost | Verifying adjacency parameters (timers, auth, passive, area) |
| `config` | Process-level config (area definitions, redistribution, network statements) | Checking OSPF process config. **Note**: on EOS devices, interface-level OSPF settings (auth, timers) are NOT included — use `interfaces` instead |
| `database` | LSDB contents (LSA types, ages, router-ids) | Investigating missing routes |
| `details` | Process-level details (SPF stats, router-id, ABR/ASBR role) | Checking NSSA translation, SPF timers |

### Adjacency Checklist
Run `get_ospf(device, "interfaces")` and verify:

> **Work through this list in order.** Do not skip to item 4 (auth) just because authentication
> is configured. `get_ospf(device, "interfaces")` output contains BOTH timer values AND auth info —
> read and compare timer values on both sides first.

1. **Hello/dead timers match on both ends?** Read hello/dead values from
   `get_ospf(device, "interfaces")` on **each side** and compare them.
   Mismatch → root cause found, stop here. Do not proceed to item 4.
   **Standard defaults** (broadcast/point-to-point): hello=10, dead=40. Both Cisco IOS and
   Arista EOS default to these values. Any other dead interval (e.g. 7) is non-standard.
   **Fix direction**: restore the device with non-standard values to defaults — never change
   correctly-configured devices to match a misconfigured outlier.
2. **Area ID match?** (mismatched area → stuck in INIT/DOWN)
3. **Network type match?** (point-to-point vs broadcast → must match)
4. **Auth key and type match?** (key-id AND key string, case-sensitive)
5. **Interface passive?** (`passive-interface` disables hellos)
6. **MTU match?** (most common cause of EXSTART/EXCHANGE stuck)

---

## Symptom: Missing Routes

When a route should be in the RIB but isn't:

```
get_ospf(device, "database")
get_routing(device, prefix="<expected-prefix>")
```

### LSA Type Lookup
Understand what should be in the LSDB before diagnosing what's missing:

| Type | Name | Who generates | Flooded |
|------|------|---------------|---------|
| 1 | Router LSA | Every router | Within area |
| 2 | Network LSA | DR on broadcast | Within area |
| 3 | Summary LSA | ABR | Between areas |
| 4 | ASBR Summary | ABR | Other areas |
| 5 | External LSA | ASBR | All areas (except stub) |
| 7 | NSSA External | ASBR in NSSA | NSSA only → converted to Type 5 at ABR |

### Area-Type Route Presence Rules
Critical for interpreting the LSDB:

- **Stub**: No Type 5/7. ABR injects inter-area summaries (Type 3) + default. External routes blocked.
- **Totally stubby** (stub with `no-summary`): No Type 3/5/7. Only a single default (Type 3) from ABR. Know the difference — look for presence/absence of Type 3 LSAs.
- **NSSA**: Type 7 generated by ASBR internally. ABR translates to Type 5 for the backbone. Check both ends: Type 7 in NSSA area, Type 5 in backbone.
- **Backbone Area 0**: All LSA types allowed.

---

## Symptom: NSSA-Specific Issues

When redistributed routes are missing in an NSSA area:

1. **Type 7 LSA not generated** → check `redistribute` config on the ASBR
   ```
   get_ospf(device, "config")
   ```
   Look for the redistribute statement; if missing, that's the issue.

2. **Type 7 present in area but Type 5 missing in backbone** → NSSA ABR translation issue
   - Check ABR has `area X nssa` (not `area X nssa no-redistribution`)
   - Multiple NSSA ABRs? Only the one with highest RID translates; verify with `get_ospf(device, "details")`

3. **Default not propagating into NSSA** → ABR must have `area X nssa default-information-originate`

---

## Symptom: Authentication Failures

When neighbors are stuck in INIT with auth mismatch:

> **Before investigating auth keys**: confirm hello/dead timers match on both sides.
> Timer mismatch and auth key mismatch produce identical symptoms (interface Up/Up, L3
> reachable, neighbor count = 0). Timer values and auth type are both visible in
> `get_ospf(device, "interfaces")` output. Check timers first.

```
get_ospf(device, "interfaces")       → shows auth type, timer values, and all OSPF interface details
```

Check: key-id match, key-string match (case-sensitive), MD5 vs plain text type consistent on both ends.

---

## Verification Checklist (Post-Fix)

- [ ] All expected neighbors in FULL state
- [ ] `get_ospf(device, "database")` shows expected LSA types for the area type
- [ ] `get_routing(device)` shows all expected prefixes with correct next-hops
- [ ] For redistributed routes: Type 5 (from backbone) or Type 7 (from NSSA ASBR) present
